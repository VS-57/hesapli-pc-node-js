<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ürün Listesi</title>
    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      .product-card {
        margin-bottom: 30px;
      }
      .product-image {
        height: 200px;
        object-fit: contain;
      }
      .card-body {
        font-size: 0.9rem;
      }
      .filter-sidebar {
        border-right: 1px solid #ddd;
        padding-right: 20px;
      }
      .filter-sidebar h5 {
        margin-top: 20px;
      }
    </style>
  </head>
  <body>
    <div style="margin: 10px">
      <h1 class="text-center mb-5">Ürün Listesi</h1>
      <div class="row">
        <div class="col-md-3 filter-sidebar">
          <h5>Filtreler</h5>
          <div class="form-group">
            <label for="priceRange">Fiyat Aralığı</label>
            <select id="priceRange" class="form-control">
              <option value="all">Tümü</option>
              <option value="0-50000">0 - 50,000₺</option>
              <option value="50000-100000">50,000₺ - 100,000₺</option>
              <option value="100000-150000">100,000₺ - 150,000₺</option>
            </select>
          </div>
          <div class="form-group">
            <label>İşlemci</label><br />
            <div class="form-check">
              <input
                class="form-check-input"
                type="checkbox"
                value="Intel"
                id="Intel"
              />
              <label class="form-check-label" for="Intel">Intel</label>
            </div>
            <div class="form-check">
              <input
                class="form-check-input"
                type="checkbox"
                value="AMD"
                id="AMD"
              />
              <label class="form-check-label" for="AMD">AMD</label>
            </div>
          </div>
        </div>
        <div class="col-md-9">
          <div class="row mb-4">
            <div class="col-md-6">
              <input
                type="text"
                id="filterInput"
                class="form-control"
                placeholder="Ürün adında ara..."
              />
            </div>
          </div>
          <div class="row" id="productList">
            <!-- Ürün Kartları burada görüntülenecek -->
            <div class="col-md-4 product-card">
              <div class="card">
                <img
                  class="card-img-top product-image"
                  src="product1.jpg"
                  alt="Ürün 1"
                />
                <div class="card-body">
                  <h5 class="card-title">Ürün 1</h5>
                  <p class="card-text">Ürün 1 açıklaması</p>
                  <p class="card-text"><strong>Fiyat:</strong> 50,000₺</p>
                </div>
              </div>
            </div>
            <div class="col-md-4 product-card">
              <div class="card">
                <img
                  class="card-img-top product-image"
                  src="product2.jpg"
                  alt="Ürün 2"
                />
                <div class="card-body">
                  <h5 class="card-title">Ürün 2</h5>
                  <p class="card-text">Ürün 2 açıklaması</p>
                  <p class="card-text"><strong>Fiyat:</strong> 75,000₺</p>
                </div>
              </div>
            </div>
            <div class="col-md-4 product-card">
              <div class="card">
                <img
                  class="card-img-top product-image"
                  src="product3.jpg"
                  alt="Ürün 3"
                />
                <div class="card-body">
                  <h5 class="card-title">Ürün 3</h5>
                  <p class="card-text">Ürün 3 açıklaması</p>
                  <p class="card-text"><strong>Fiyat:</strong> 100,000₺</p>
                </div>
              </div>
            </div>
            <!-- Diğer ürün kartları burada -->
          </div>
        </div>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>

      function getProducts() {
        fetch("http://localhost:3000/api/getAll", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
        })
          .then((response) => response.json())
          .then((data) => {
            console.log(data);
            displayProducts(data);
          })
          .catch((error) => console.error("Error:", error));
      }

      document
        .getElementById("filterInput")
        .addEventListener("keyup", function () {
          filterProducts();
        });

      document
        .getElementById("priceRange")
        .addEventListener("change", function () {
          filterProducts();
        });

      document
        .querySelectorAll(".form-check-input")
        .forEach(function (checkbox) {
          checkbox.addEventListener("change", function () {
            filterProducts();
          });
        });

      document.addEventListener("DOMContentLoaded", function () {
        renderProducts(getProducts());
      });

      function filterProducts() {
        var filterValue = document
          .getElementById("filterInput")
          .value.toLowerCase();
        var priceRange = document.getElementById("priceRange").value;
        var selectedCPUs = Array.from(
          document.querySelectorAll(".form-check-input:checked")
        ).map((checkbox) => checkbox.value);

        var products = getProducts();
        var filteredProducts = products.filter(function (product) {
          var matchesFilter = product.name.toLowerCase().includes(filterValue);

          var matchesPrice = true;
          if (priceRange !== "all") {
            var [minPrice, maxPrice] = priceRange.split("-").map(Number);
            matchesPrice =
              product.price >= minPrice && product.price <= maxPrice;
          }

          var matchesCPU = true;
          if (selectedCPUs.length > 0) {
            matchesCPU = selectedCPUs.some((cpu) =>
              product.specs.CPU.includes(cpu)
            );
          }

          return matchesFilter && matchesPrice && matchesCPU;
        });

        renderProducts(filteredProducts);
      }

      function renderProducts(products) {
        var productList = document.getElementById("productList");
        productList.innerHTML = "";

        products.forEach(function (product) {
          var productCard = `
            <div class="col-md-4 product-item">
                <div class="card product-card">
                    <img src="${product.image}" class="card-img-top product-image" alt="${product.name}">
                    <div class="card-body">
                        <h5 class="card-title">${product.name}</h5>
                        <ul class="list-unstyled">
                            <li><strong>CPU:</strong> ${product.specs.CPU}</li>
                            <li><strong>GPU:</strong> ${product.specs.GPU}</li>
                            <li><strong>Motherboard:</strong> ${product.specs.Motherboard}</li>
                            <li><strong>RAM:</strong> ${product.specs.RAM}</li>
                            <li><strong>Storage:</strong> ${product.specs.Storage}</li>
                        </ul>
                        <p class="card-text"><strong>Fiyat: ₺${product.price}</strong></p>
                        <a href="${product.link}" class="btn btn-primary">Detayları Gör</a>
                    </div>
                </div>
            </div>
          `;
          productList.insertAdjacentHTML("beforeend", productCard);
        });
      }

      document.addEventListener('DOMContentLoaded', getProducts);

    </script>
  </body>
</html>
