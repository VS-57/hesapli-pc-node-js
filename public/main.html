<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>En Ucuz Hazır Sistem</title>
    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      .product-card {
        margin-bottom: 30px;
      }

      .product-image {
        height: 200px;
        object-fit: contain;
      }

      .card-body {
        font-size: 0.9rem;
      }

      .filter-sidebar {
        border-right: 1px solid #ddd;
        padding-right: 20px;
      }

      .filter-sidebar h5 {
        margin-top: 20px;
      }

      .product-item {
        position: relative;
      }

      .scrollable-filters {
        max-height: 300px;
        overflow-y: auto;
      }

      .logo-container {
        position: absolute;
        bottom: 10px;
        right: 10px;
      }

      .store-logo {
        max-width: 50px;
      }

      .header {
        background-color: #1c2938;
        padding: 20px;
      }
      .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
      }
      .site-logo {
        flex: 1;
        text-align: center;
      }

      .header-title {
        color: #f7f8f9;
        flex: 1;
        text-align: center;
        margin: 10px 0;
      }
      .search-box {
        flex: 3;
        width: 100%;
      }
      .search-box input {
        width: 100%;
      }
      @media (max-width: 768px) {
        .site-logo,
        .header-title,
        .search-box {
          flex: 1 0 100%;
          text-align: center;
        }
        .header-title {
          order: 1;
        }
        .site-logo {
          order: 2;
        }
        .search-box {
          order: 3;
          margin-top: 10px;
        }
      }
      @media (max-width: 480px) {
        .header-title {
          display: none;
        }
      }
    </style>
  </head>

  <body style="background-color: #f7f8f9">
    <header class="header">
      <div class="header-content">
        <h1 class="header-title">Ucuza Sistem</h1>
        <div class="search-box">
          <input
            type="text"
            id="filterInput"
            class="form-control"
            placeholder="Ürün ara..."
          />
        </div>
      </div>
    </header>
    <div class="container-fluid">
      <div class="row">
        <!-- Sidebar (filter menu) -->
        <nav class="col-md-2 d-none d-md-block bg-light sidebar filter-sidebar">
          <div class="filter-content">
            <h5>Filtreler</h5>
            <button
              id="resetFilters"
              class="btn btn-secondary"
              style="width: 100%; background-color: #1c2938"
            >
              Filtreleri Sıfırla
            </button>
            <div class="form-group row">
              <div class="col">
                <label for="startPrice">Başlangıç Fiyatı</label>
                <input
                  type="number"
                  id="startPrice"
                  class="form-control"
                  placeholder="0"
                />
              </div>
              <div class="col">
                <label for="endPrice">Bitiş Fiyatı</label>
                <input
                  type="number"
                  id="endPrice"
                  class="form-control"
                  placeholder="35000"
                />
              </div>
            </div>
            <div class="form-group" style="display: flex; flex-wrap: wrap">
              <label style="width: 90%">Mağaza</label><br />
              <div
                class="form-check"
                style="flex: 1 0 33.33%; box-sizing: border-box"
              >
                <input
                  class="form-check-input"
                  type="checkbox"
                  value="itopya"
                  id="itopya"
                />
                <label class="form-check-label" for="itopya">Itopya</label>
              </div>
              <div
                class="form-check"
                style="flex: 1 0 33.33%; box-sizing: border-box"
              >
                <input
                  class="form-check-input"
                  type="checkbox"
                  value="gamingGen"
                  id="gamingGen"
                />
                <label class="form-check-label" for="gamingGen"
                  >GamingGen</label
                >
              </div>
              <div
                class="form-check"
                style="flex: 1 0 33.33%; box-sizing: border-box"
              >
                <input
                  class="form-check-input"
                  type="checkbox"
                  value="gameGaraj"
                  id="gameGaraj"
                />
                <label class="form-check-label" for="gameGaraj"
                  >GameGaraj</label
                >
              </div>
              <div
                class="form-check"
                style="flex: 1 0 33.33%; box-sizing: border-box"
              >
                <input
                  class="form-check-input"
                  type="checkbox"
                  value="pckolik"
                  id="pckolik"
                />
                <label class="form-check-label" for="pckolik">PcKolik</label>
              </div>
              <div
                class="form-check"
                style="flex: 1 0 33.33%; box-sizing: border-box"
              >
                <input
                  class="form-check-input"
                  type="checkbox"
                  value="vatan"
                  id="vatan"
                />
                <label class="form-check-label" for="vatan">Vatan</label>
              </div>
              <div
                class="form-check"
                style="flex: 1 0 33.33%; box-sizing: border-box"
              >
                <input
                  class="form-check-input"
                  type="checkbox"
                  value="sinerji"
                  id="sinerji"
                />
                <label class="form-check-label" for="sinerji">Sinerji</label>
              </div>
            </div>

            <div class="form-group row">
              <div class="form-group col">
                <label>İşlemci Markası</label><br />
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    value="Intel"
                    id="Intel"
                  />
                  <label class="form-check-label" for="Intel">Intel</label>
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    value="AMD"
                    id="AMD"
                  />
                  <label class="form-check-label" for="AMD">AMD</label>
                </div>
              </div>
              <div class="form-group col">
                <label>Ekran Kartı</label><br />
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    value="RTX"
                    id="RTX"
                  />
                  <label class="form-check-label" for="RTX">NVIDIA RTX</label>
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    value="GTX"
                    id="GTX"
                  />
                  <label class="form-check-label" for="GTX">NVIDIA GTX</label>
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    value="RX"
                    id="RX"
                  />
                  <label class="form-check-label" for="RX">AMD RX</label>
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    value="ARC"
                    id="ARC"
                  />
                  <label class="form-check-label" for="ARC">Intel ARC</label>
                </div>
              </div>
            </div>
            <div class="form-group">
              <label>Ekran Kartı Modeli</label><br />
              <input
                type="text"
                style="margin-bottom: 5px"
                id="gpuSearch"
                class="form-control"
                placeholder="Ekran kartı ara..."
              />
              <div id="gpuModelFilters" class="scrollable-filters">
                <!-- İşlemci modelleri dinamik olarak burada eklenecek -->
              </div>
            </div>
            <div class="form-group">
              <label>İşlemci Modeli</label><br />
              <input
                type="text"
                style="margin-bottom: 5px"
                id="processorSearch"
                class="form-control"
                placeholder="İşlemci modelinde ara..."
              />
              <div id="processorModelFilters" class="scrollable-filters">
                <!-- İşlemci modelleri dinamik olarak burada eklenecek -->
              </div>
            </div>
          </div>
        </nav>
        <!-- Mobile Sidebar -->
        <nav class="col-md-2 d-md-none bg-light">
          <button
            class="navbar-toggler"
            type="button"
            data-toggle="collapse"
            data-target="#filterMenu"
            aria-controls="filterMenu"
            aria-expanded="false"
            aria-label="Toggle navigation"
            style="margin: 10px; margin-bottom: 20px; border-color: #1c2938"
          >
            <span class="navbar-toggler-icon">
              <i style="margin-top: 4px" class="fas fa-bars"></i>
            </span>
            Filtreler
          </button>

          <div class="collapse" id="filterMenu">
            <div class="filter-content">
              <button
                id="resetFilters"
                class="btn btn-secondary"
                style="width: 100%; background-color: #1c2938"
              >
                Filtreleri Sıfırla
              </button>
              <div class="form-group row">
                <div class="col">
                  <label for="startPriceMobile">Başlangıç Fiyatı</label>
                  <input
                    type="number"
                    id="startPriceMobile"
                    class="form-control"
                    placeholder="0"
                  />
                </div>
                <div class="col">
                  <label for="endPriceMobile">Bitiş Fiyatı</label>
                  <input
                    type="number"
                    id="endPriceMobile"
                    class="form-control"
                    placeholder="35000"
                  />
                </div>
              </div>
              <div class="form-group" style="display: flex; flex-wrap: wrap">
                <label style="width: 90%">Mağaza</label><br />
                <div
                  class="form-check"
                  style="flex: 1 0 33.33%; box-sizing: border-box"
                >
                  <input
                    class="form-check-input"
                    type="checkbox"
                    value="itopya"
                    id="itopya"
                  />
                  <label class="form-check-label" for="itopya">Itopya</label>
                </div>
                <div
                  class="form-check"
                  style="flex: 1 0 33.33%; box-sizing: border-box"
                >
                  <input
                    class="form-check-input"
                    type="checkbox"
                    value="gamingGen"
                    id="gamingGen"
                  />
                  <label class="form-check-label" for="gamingGen"
                    >GamingGen</label
                  >
                </div>
                <div
                  class="form-check"
                  style="flex: 1 0 33.33%; box-sizing: border-box"
                >
                  <input
                    class="form-check-input"
                    type="checkbox"
                    value="gameGaraj"
                    id="gameGaraj"
                  />
                  <label class="form-check-label" for="gameGaraj"
                    >GameGaraj</label
                  >
                </div>
                <div
                  class="form-check"
                  style="flex: 1 0 33.33%; box-sizing: border-box"
                >
                  <input
                    class="form-check-input"
                    type="checkbox"
                    value="pckolik"
                    id="pckolik"
                  />
                  <label class="form-check-label" for="pckolik">PcKolik</label>
                </div>
                <div
                  class="form-check"
                  style="flex: 1 0 33.33%; box-sizing: border-box"
                >
                  <input
                    class="form-check-input"
                    type="checkbox"
                    value="vatan"
                    id="vatan"
                  />
                  <label class="form-check-label" for="vatan">Vatan</label>
                </div>
                <div
                  class="form-check"
                  style="flex: 1 0 33.33%; box-sizing: border-box"
                >
                  <input
                    class="form-check-input"
                    type="checkbox"
                    value="sinerji"
                    id="sinerji"
                  />
                  <label class="form-check-label" for="sinerji">Sinerji</label>
                </div>
              </div>
              <div class="form-group row">
                <div class="form-group col">
                  <label>İşlemci Markası</label><br />
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      value="Intel"
                      id="Intel"
                    />
                    <label class="form-check-label" for="Intel">Intel</label>
                  </div>
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      value="AMD"
                      id="AMD"
                    />
                    <label class="form-check-label" for="AMD">AMD</label>
                  </div>
                </div>
                <div class="form-group col">
                  <label>Ekran Kartı</label><br />
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      value="RTX"
                      id="RTX"
                    />
                    <label class="form-check-label" for="RTX">NVIDIA RTX</label>
                  </div>
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      value="GTX"
                      id="GTX"
                    />
                    <label class="form-check-label" for="GTX">NVIDIA GTX</label>
                  </div>
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      value="RX"
                      id="RX"
                    />
                    <label class="form-check-label" for="RX">AMD RX</label>
                  </div>
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      value="ARC"
                      id="ARC"
                    />
                    <label class="form-check-label" for="ARC">Intel ARC</label>
                  </div>
                </div>
              </div>
              <div class="form-group">
                <label>Ekran Kartı Modeli</label><br />
                <input
                  type="text"
                  style="margin-bottom: 5px"
                  id="gpuSearch"
                  class="form-control"
                  placeholder="Ekran kartı ara..."
                />
                <div id="gpuModelFiltersMobile" class="scrollable-filters">
                  <!-- İşlemci modelleri dinamik olarak burada eklenecek -->
                </div>
              </div>
              <div class="form-group">
                <label>İşlemci Modeli</label><br />
                <input
                  type="text"
                  style="margin-bottom: 5px"
                  id="processorSearch"
                  class="form-control"
                  placeholder="İşlemci modelinde ara..."
                />
                <div
                  id="processorModelFiltersMobile"
                  class="scrollable-filters"
                >
                  <!-- İşlemci modelleri dinamik olarak burada eklenecek -->
                </div>
              </div>
            </div>
          </div>
        </nav>
        <!-- Main content -->
        <div class="col-md-10">
          <div class="row mb-4" style="margin-top: 10px">
            <div style="margin-top: 9px">
              <p style="display: inline; margin: 0 15px">
                <strong>Ürün Sayısı:</strong>
              </p>
              <p id="productCount" style="display: inline; margin: 0 10px">0</p>
            </div>
            <div style="margin-top: 3px; display: flex; align-items: center">
              <p style="display: inline; margin: 0 15px">
                <strong>Stoktakileri göster</strong>
              </p>
              <input
                type="checkbox"
                id="showInStock"
                style="
                  margin: 0 10px;
                  width: 20px;
                  height: 20px;
                  vertical-align: middle;
                "
                checked
              />
            </div>
            <div class="col-md-3">
              <select id="sortOrder" class="form-control">
                <option value="default">Sırala</option>
                <option value="lowToHigh">Fiyat: Düşükten Yükseğe</option>
                <option value="highToLow">Fiyat: Yüksekten Düşüğe</option>
              </select>
            </div>
          </div>

          <div class="row" id="productList">
            <!-- Ürün Kartları burada görüntülenecek -->
          </div>
        </div>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="data.js"></script>
    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-MN0RJQRG23"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-MN0RJQRG23");
    </script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />

    <script>
      // Populate the filters when the page loads
      function initFilters() {
        populateProcessorModelFilters();
        populateGpuModelFilters();
      }

      let isMobile = false;

      function checkIfMobile() {
        isMobile = window.innerWidth <= 800;
      }

      // İlk yüklemede kontrol et
      checkIfMobile();

      // Pencere yeniden boyutlandırıldığında kontrol et
      window.addEventListener("resize", checkIfMobile);

      // Ayrıca, sayfa yüklendiğinde de kontrol edebilirsiniz
      window.addEventListener("load", checkIfMobile);

      function populateProcessorModelFilters() {
        const processorModelFilters = isMobile
          ? document.getElementById("processorModelFiltersMobile")
          : document.getElementById("processorModelFilters");

        processorModelFilters.innerHTML = ""; // Clear existing content
        processors.forEach((processor) => {
          const div = document.createElement("div");
          div.className = "form-check";
          const input = document.createElement("input");
          input.className = "form-check-input";
          input.type = "checkbox";
          input.value = processor.value;
          input.id = processor.value;
          input.addEventListener("change", filterProducts);

          const label = document.createElement("label");
          label.className = "form-check-label";
          label.htmlFor = processor.value;
          label.textContent = processor.name;

          div.appendChild(input);
          div.appendChild(label);
          processorModelFilters.appendChild(div);
        });
      }

      function populateGpuModelFilters() {
        const gpuModelFilters = isMobile
          ? document.getElementById("gpuModelFiltersMobile")
          : document.getElementById("gpuModelFilters");
        gpuModelFilters.innerHTML = ""; // Clear existing content
        gpus.forEach((gpu) => {
          const div = document.createElement("div");
          div.className = "form-check";
          const input = document.createElement("input");
          input.className = "form-check-input";
          input.type = "checkbox";
          input.value = gpu.value;
          input.id = gpu.value;
          input.addEventListener("change", filterProducts);

          const label = document.createElement("label");
          label.className = "form-check-label";
          label.htmlFor = gpu.value;
          label.textContent = gpu.name;

          div.appendChild(input);
          div.appendChild(label);
          gpuModelFilters.appendChild(div);
        });
      }

      function filterProcessorModels() {
        const searchTerm = document
          .getElementById("processorSearch")
          .value.toLowerCase();

        // Store the current checked states
        const currentCheckedStates = {};
        document
          .querySelectorAll("#processorModelFilters .form-check-input")
          .forEach((checkbox) => {
            currentCheckedStates[checkbox.id] = checkbox.checked;
          });

        const processorModelFilters = isMobile
          ? document.getElementById("processorModelFiltersMobile")
          : document.getElementById("processorModelFilters");

        processorModelFilters.innerHTML = ""; // Clear existing content

        processors.forEach((processor) => {
          const div = document.createElement("div");
          div.className = "form-check";
          const input = document.createElement("input");
          input.className = "form-check-input";
          input.type = "checkbox";
          input.value = processor.value;
          input.id = processor.value;

          // Restore the checked state if it was checked before
          if (currentCheckedStates[processor.value]) {
            input.checked = true;
          }

          input.addEventListener("change", filterProducts);

          if (processor.name.toLowerCase().includes(searchTerm)) {
            div.style.display = "block";
          } else {
            div.style.display = "none";
          }

          const label = document.createElement("label");
          label.className = "form-check-label";
          label.htmlFor = processor.value;
          label.textContent = processor.name;

          div.appendChild(input);
          div.appendChild(label);
          processorModelFilters.appendChild(div);
        });
      }

      function filterGpuModels() {
        const searchTerm = document
          .getElementById("gpuSearch")
          .value.toLowerCase();

        // Store the current checked states
        const currentCheckedStates = {};
        document
          .querySelectorAll("#gpuModelFilters .form-check-input")
          .forEach((checkbox) => {
            currentCheckedStates[checkbox.id] = checkbox.checked;
          });

        const gpuModelFilters = isMobile
          ? document.getElementById("gpuModelFiltersMobile")
          : document.getElementById("gpuModelFilters");

        gpuModelFilters.innerHTML = ""; // Clear existing content

        gpus.forEach((gpu) => {
          const div = document.createElement("div");
          div.className = "form-check";
          const input = document.createElement("input");
          input.className = "form-check-input";
          input.type = "checkbox";
          input.value = gpu.value;
          input.id = gpu.value;

          // Restore the checked state if it was checked before
          if (currentCheckedStates[gpu.value]) {
            input.checked = true;
          }

          input.addEventListener("change", filterProducts);

          if (gpu.name.toLowerCase().includes(searchTerm)) {
            div.style.display = "block";
          } else {
            div.style.display = "none";
          }

          const label = document.createElement("label");
          label.className = "form-check-label";
          label.htmlFor = gpu.value;
          label.textContent = gpu.name;

          div.appendChild(input);
          div.appendChild(label);
          gpuModelFilters.appendChild(div);
        });
      }

      async function getProducts() {
        try {
          const response = await fetch(
            "https://ucuzasistem.up.railway.app/api/getAll",
            {
              method: "GET",
              headers: {
                "Content-Type": "application/json",
              },
            }
          );
          const data = await response.json();
          return data;
        } catch (error) {
          console.error("Error:", error);
          return [];
        }
      }

      function setupEventListeners() {
        document
          .getElementById("filterInput")
          .addEventListener("keyup", filterProducts);
        document
          .getElementById("startPrice")
          .addEventListener("input", filterProducts);
        document
          .getElementById("endPrice")
          .addEventListener("input", filterProducts);
        document
          .getElementById("startPriceMobile")
          .addEventListener("input", filterProducts);
        document
          .getElementById("endPriceMobile")
          .addEventListener("input", filterProducts);
        document
          .getElementById("sortOrder")
          .addEventListener("change", filterProducts);
        document
          .getElementById("showInStock")
          .addEventListener("change", filterProducts);
        document
          .querySelectorAll(".form-check-input")
          .forEach(function (checkbox) {
            checkbox.addEventListener("change", filterProducts);
          });
        document
          .getElementById("processorSearch")
          .addEventListener("input", filterProcessorModels);
        document
          .getElementById("gpuSearch")
          .addEventListener("input", filterGpuModels);
        document
          .getElementById("resetFilters")
          .addEventListener("click", resetFilters);
      }

      function resetFilters() {
        document.getElementById("filterInput").value = "";
        document.getElementById("startPrice").value = "";
        document.getElementById("endPrice").value = "";
        document.getElementById("startPriceMobile").value = "";
        document.getElementById("endPriceMobile").value = "";
        document
          .querySelectorAll(".form-check-input")
          .forEach(function (checkbox) {
            checkbox.checked = false;
          });
        document.getElementById("sortOrder").value = "default";
        document.getElementById("showInStock").checked = true;
        filterProducts();
      }

      async function filterProducts() {
        const filterValue = document
          .getElementById("filterInput")
          .value.toLowerCase();
        const startPrice = isMobile
          ? Number(document.getElementById("startPriceMobile").value) || 0
          : Number(document.getElementById("startPrice").value) || 0;
        const endPrice = isMobile
          ? Number(document.getElementById("endPriceMobile").value) || Infinity
          : Number(document.getElementById("endPrice").value) || Infinity;
        const selectedCPUs = Array.from(
          document.querySelectorAll(".form-check-input:checked")
        )
          .filter(
            (checkbox) =>
              checkbox.id.includes("Intel") || checkbox.id.includes("AMD")
          )
          .map((checkbox) => checkbox.value.toLowerCase());

        const selectedGPUs = Array.from(
          document.querySelectorAll(".form-check-input:checked")
        )
          .filter(
            (checkbox) =>
              checkbox.id.includes("RTX") ||
              checkbox.id.includes("GTX") ||
              checkbox.id.includes("ARC") ||
              checkbox.id.includes("RX")
          )
          .map((checkbox) => checkbox.value.toLowerCase());

        const selectedModels = Array.from(
          document.querySelectorAll(".form-check-input:checked")
        )
          .filter(
            (checkbox) =>
              !checkbox.id.includes("Intel") &&
              !checkbox.id.includes("AMD") &&
              !checkbox.id.includes("RTX") &&
              !checkbox.id.includes("ARC") &&
              !checkbox.id.includes("GTX") &&
              !checkbox.id.includes("RX") &&
              !checkbox.id.includes("itopya") &&
              !checkbox.id.includes("gamingGen") &&
              !checkbox.id.includes("pckolik") &&
              !checkbox.id.includes("vatan") &&
              !checkbox.id.includes("sinerji") &&
              !checkbox.id.includes("gameGaraj")
          )
          .map((checkbox) => checkbox.value.toLowerCase());

        const sortOrder = document.getElementById("sortOrder").value;
        const showInStock = document.getElementById("showInStock").checked;
        const selectedStores = Array.from(
          document.querySelectorAll(".form-check-input:checked")
        )
          .filter(
            (checkbox) =>
              checkbox.id.includes("itopya") ||
              checkbox.id.includes("gamingGen") ||
              checkbox.id.includes("gameGaraj") ||
              checkbox.id.includes("pckolik") ||
              checkbox.id.includes("sinerji") ||
              checkbox.id.includes("vatan")
          )
          .map((checkbox) => checkbox.value.toLowerCase());

        const products = await getProducts();
        let filteredProducts = products.filter(function (product) {
          const matchesFilter = product.name
            ?.toLowerCase()
            .includes(filterValue);
          const matchesPrice =
            product.price >= startPrice && product.price <= endPrice;

          let matchesCPU = true;
          if (selectedCPUs.length > 0) {
            matchesCPU = selectedCPUs.some((cpu) =>
              product.specs.CPU?.toLowerCase().includes(cpu)
            );
          }

          let matchesGPU = true;
          if (selectedGPUs.length > 0) {
            matchesGPU = selectedGPUs.some((gpu) =>
              product.specs.GPU?.toLowerCase().includes(gpu)
            );
          }

          let matchesModel = true;
          if (selectedModels.length > 0) {
            matchesModel = selectedModels.some(
              (model) =>
                product.specs.CPU?.toLowerCase().includes(model) ||
                product.specs.GPU?.toLowerCase().trim().includes(model.trim())
            );
          }

          let matchesStock = true;
          if (showInStock) {
            matchesStock =
              product.price !== null &&
              product.price !== undefined &&
              product.price !== 0;
          }

          let matchesStore = true;
          if (selectedStores.length > 0) {
            matchesStore = selectedStores.some((store) =>
              product.store.toLowerCase().includes(store)
            );
          }

          return (
            matchesFilter &&
            matchesPrice &&
            matchesCPU &&
            matchesGPU &&
            matchesModel &&
            matchesStock &&
            matchesStore
          );
        });

        if (sortOrder === "lowToHigh") {
          filteredProducts.sort((a, b) => a.price - b.price);
        } else if (sortOrder === "highToLow") {
          filteredProducts.sort((a, b) => b.price - a.price);
        }

        renderProducts(filteredProducts);
        document.getElementById("productCount").textContent =
          filteredProducts.length;
      }

      function renderProducts(products) {
        const productList = document.getElementById("productList");
        productList.innerHTML = "";

        products.forEach(function (product) {
          const formattedPrice = new Intl.NumberFormat("tr-TR", {
            style: "currency",
            currency: "TRY",
          }).format(product.price ?? 0);

          const productCard = `
<div class="col-md-4 product-item">
    <div class="card product-card" style="position: relative;">
        <img src="${
          product.image
        }" style="margin-top:20px" class="card-img-top product-image" alt="${
            product?.name ?? ""
          }" onerror="this.onerror=null;this.src='https://previews.123rf.com/images/blankstock/blankstock1812/blankstock181201188/113234166-no-or-stop-sign-computer-line-icon-pc-component-sign-monitor-with-case-symbol-caution-prohibited-ban.jpg';">
        <div class="card-body" style="display: flex; flex-direction: column; justify-content: space-between; flex-grow: 1;">
            <h5 class="card-title">${product.name ?? ""}</h5>
            <ul class="list-unstyled">
                <li><strong>CPU:</strong> ${product.specs.CPU ?? ""}</li>
                <li><strong>GPU:</strong> ${product.specs.GPU ?? ""}</li>
                <li><strong>Motherboard:</strong> ${
                  product.specs.Motherboard ?? ""
                }</li>
                <li><strong>RAM:</strong> ${product.specs.Ram ?? ""}</li>
                <li><strong>Storage:</strong> ${
                  product.specs?.Storage ?? ""
                }</li>
            </ul>
            <p class="card-text"><strong>Fiyat: ${formattedPrice}</strong></p>
            <a href="${
              product.link
            }" class="btn btn-primary" style="background-color:#1c2938;border-color:#1c2938">Detayları Gör</a>
        </div>
        <div style="position: absolute; top: 10px; right: 10px;">
            <img src="/logos/${product.store?.toLowerCase()}.png" alt="${
            product.store
          } logo" class="store-logo" style="width: 50px; height: auto;">
        </div>
    </div>
</div>
`;
          productList.insertAdjacentHTML("beforeend", productCard);
        });
      }

      document.addEventListener("DOMContentLoaded", async function () {
        await initFilters();
        setupEventListeners();
        const products = await getProducts();
        filterProducts();
        document.getElementById("productCount").textContent = products.length;
      });
    </script>
  </body>
</html>
