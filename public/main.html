<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>En Ucuz Hazır Sistem</title>
    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      .product-card {
        margin-bottom: 30px;
      }

      .product-image {
        height: 200px;
        object-fit: contain;
      }

      .card-body {
        font-size: 0.9rem;
      }

      .filter-sidebar {
        border-right: 1px solid #ddd;
        padding-right: 20px;
      }

      .filter-sidebar h5 {
        margin-top: 20px;
      }

      .scrollable-filters {
        max-height: 300px; /* Set the maximum height */
        overflow-y: auto; /* Enable vertical scrolling */
      }
    </style>
  </head>

  <body>
    <div style="margin: 10px">
      <h1 class="text-center mb-5">Hazır Sistemler</h1>
      <div class="row">
        <div class="col-md-3 filter-sidebar" style="margin-left: 15px">
          <h5>Filtreler</h5>
          <div class="form-group">
            <label for="startPrice">Başlangıç Fiyatı</label>
            <input
              type="number"
              id="startPrice"
              class="form-control"
              placeholder="0"
            />
          </div>
          <div class="form-group">
            <label for="endPrice">Bitiş Fiyatı</label>
            <input
              type="number"
              id="endPrice"
              class="form-control"
              placeholder="35000"
            />
          </div>
          <div class="form-group">
            <label>İşlemci Markası</label><br />
            <div class="form-check">
              <input
                class="form-check-input"
                type="checkbox"
                value="Intel"
                id="Intel"
              />
              <label class="form-check-label" for="Intel">Intel</label>
            </div>
            <div class="form-check">
              <input
                class="form-check-input"
                type="checkbox"
                value="AMD"
                id="AMD"
              />
              <label class="form-check-label" for="AMD">AMD</label>
            </div>
          </div>
          <div class="form-group">
            <label>Ekran Kartı</label><br />
            <div class="form-check">
              <input
                class="form-check-input"
                type="checkbox"
                value="RTX"
                id="RTX"
              />
              <label class="form-check-label" for="RTX">NVIDIA RTX</label>
            </div>
            <div class="form-check">
              <input
                class="form-check-input"
                type="checkbox"
                value="GTX"
                id="GTX"
              />
              <label class="form-check-label" for="GTX">NVIDIA GTX</label>
            </div>
            <div class="form-check">
              <input
                class="form-check-input"
                type="checkbox"
                value="RX"
                id="RX"
              />
              <label class="form-check-label" for="RX">AMD RX</label>
            </div>
          </div>
          <div class="form-group">
            <label>İşlemci Modeli</label><br />
            <input
              type="text"
              style="margin-bottom: 5px"
              id="processorSearch"
              class="form-control"
              placeholder="İşlemci modelinde ara..."
            />
            <div id="processorModelFilters" class="scrollable-filters">
              <!-- İşlemci modelleri dinamik olarak burada eklenecek -->
            </div>
          </div>
        </div>
        <div class="col-md-8">
          <div class="row mb-4">
            <div class="col-md-4">
              <input
                type="text"
                id="filterInput"
                class="form-control"
                placeholder="Ürün adında ara..."
              />
            </div>
            <div class="col-md-3">
              <select id="sortOrder" class="form-control">
                <option value="default">Sırala</option>
                <option value="lowToHigh">Fiyat: Düşükten Yükseğe</option>
                <option value="highToLow">Fiyat: Yüksekten Düşüğe</option>
              </select>
            </div>
            <div style="margin-top: 3px">
              <p style="display: inline; margin: 0 15px">Ürün Sayısı</p>
              <p id="productCount" style="display: inline; margin: 0 10px">0</p>
            </div>
            <div style="margin-top: 3px">
              <p style="display: inline; margin: 0 15px">Stoktakileri göster</p>
              <input
                type="checkbox"
                id="showInStock"
                style="margin: 0 10px"
                checked
              />
            </div>
          </div>

          <div class="row" id="productList">
            <!-- Ürün Kartları burada görüntülenecek -->
          </div>
        </div>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
      const processors = [
        // Ryzen Processors
        { name: "Ryzen 3 1200", value: "1200" },
        { name: "Ryzen 3 1300X", value: "1300X" },
        { name: "Ryzen 3 2200G", value: "2200G" },
        { name: "Ryzen 3 2300X", value: "2300X" },
        { name: "Ryzen 3 3200G", value: "3200G" },
        { name: "Ryzen 3 3100", value: "3100" },
        { name: "Ryzen 3 3300X", value: "3300X" },

        { name: "Ryzen 5 1400", value: "1400" },
        { name: "Ryzen 5 1500X", value: "1500X" },
        { name: "Ryzen 5 1600", value: "1600" },
        { name: "Ryzen 5 1600X", value: "1600X" },
        { name: "Ryzen 5 2400G", value: "2400G" },
        { name: "Ryzen 5 2600", value: "2600" },
        { name: "Ryzen 5 2600X", value: "2600X" },
        { name: "Ryzen 5 3400G", value: "3400G" },
        { name: "Ryzen 5 3600", value: "3600" },
        { name: "Ryzen 5 3600X", value: "3600X" },
        { name: "Ryzen 5 3600XT", value: "3600XT" },
        { name: "Ryzen 5 4500", value: "4500" },
        { name: "Ryzen 5 4600G", value: "4600G" },
        { name: "Ryzen 5 4600GE", value: "4600GE" },
        { name: "Ryzen 5 5500", value: "5500" },
        { name: "Ryzen 5 5600", value: "5600" },
        { name: "Ryzen 5 5600X", value: "5600X" },
        { name: "Ryzen 5 5600G", value: "5600G" },
        { name: "Ryzen 5 5600GE", value: "5600GE" },
        { name: "Ryzen 5 7500F", value: "7500F" },
        { name: "Ryzen 5 7600X", value: "7600X" },

        { name: "Ryzen 7 1700", value: "1700" },
        { name: "Ryzen 7 1700X", value: "1700X" },
        { name: "Ryzen 7 1800X", value: "1800X" },
        { name: "Ryzen 7 2700", value: "2700" },
        { name: "Ryzen 7 2700X", value: "2700X" },
        { name: "Ryzen 7 3700X", value: "3700X" },
        { name: "Ryzen 7 3800X", value: "3800X" },
        { name: "Ryzen 7 3800XT", value: "3800XT" },
        { name: "Ryzen 7 5700G", value: "5700G" },
        { name: "Ryzen 7 5700X", value: "5700X" },
        { name: "Ryzen 7 5700X3D", value: "5700X3D" },

        { name: "Ryzen 7 5800X", value: "5800X" },
        { name: "Ryzen 7 5800X3D", value: "5800X3D" },
        { name: "Ryzen 7 7700X", value: "7700X" },
        { name: "Ryzen 7 7800X3D", value: "7800X3D" },

        { name: "Ryzen 9 3900X", value: "3900X" },
        { name: "Ryzen 9 3900XT", value: "3900XT" },
        { name: "Ryzen 9 3950X", value: "3950X" },
        { name: "Ryzen 9 5900X", value: "5900X" },
        { name: "Ryzen 9 5950X", value: "5950X" },
        { name: "Ryzen 9 7900X", value: "7900X" },
        { name: "Ryzen 9 7900X3D", value: "7900X3D" },

        { name: "Ryzen 9 7950X", value: "7950X" },
        { name: "Ryzen 9 7950X3D", value: "7950X3D" },

        // Intel 10th Gen Processors
        { name: "Core i3-10100", value: "10100" },
        { name: "Core i3-10300", value: "10300" },
        { name: "Core i3-10320", value: "10320" },
        { name: "Core i5-10400", value: "10400" },
        { name: "Core i5-10500", value: "10500" },
        { name: "Core i5-10600", value: "10600" },
        { name: "Core i5-10600K", value: "10600K" },
        { name: "Core i7-10700", value: "10700" },
        { name: "Core i7-10700K", value: "10700K" },
        { name: "Core i9-10900", value: "10900" },
        { name: "Core i9-10900K", value: "10900K" },

        // Intel 11th Gen Processors
        { name: "Core i3-11100", value: "11100" },
        { name: "Core i3-11300", value: "11300" },
        { name: "Core i5-11400", value: "11400" },
        { name: "Core i5-11500", value: "11500" },
        { name: "Core i5-11600K", value: "11600K" },
        { name: "Core i7-11700", value: "11700" },
        { name: "Core i7-11700K", value: "11700K" },
        { name: "Core i9-11900", value: "11900" },
        { name: "Core i9-11900K", value: "11900K" },

        // Intel 12th Gen Processors
        { name: "Core i3-12100", value: "12100" },
        { name: "Core i3-12300", value: "12300" },
        { name: "Core i5-12400", value: "12400" },
        { name: "Core i5-12600K", value: "12600K" },
        { name: "Core i7-12700", value: "12700" },
        { name: "Core i7-12700K", value: "12700K" },
        { name: "Core i9-12900", value: "12900" },
        { name: "Core i9-12900K", value: "12900K" },

        // Intel 13th Gen Processors
        { name: "Core i3-13100", value: "13100" },
        { name: "Core i5-13400", value: "13400" },
        { name: "Core i5-13600K", value: "13600K" },
        { name: "Core i7-13700", value: "13700" },
        { name: "Core i7-13700K", value: "13700K" },
        { name: "Core i9-13900", value: "13900" },
        { name: "Core i9-13900K", value: "13900K" },

        // Intel 14th Gen Processors
        { name: "Core i3-14100", value: "14100" },
        { name: "Core i5-14400", value: "14400" },
        { name: "Core i5-14600K", value: "14600K" },
        { name: "Core i7-14700", value: "14700" },
        { name: "Core i7-14700K", value: "14700K" },
        { name: "Core i9-14900", value: "14900" },
        { name: "Core i9-14900K", value: "14900K" },
      ];

      document.addEventListener("DOMContentLoaded", function () {
        populateProcessorModelFilters();
        document
          .getElementById("processorSearch")
          .addEventListener("input", filterProcessorModels);
      });

      function populateProcessorModelFilters() {
        const processorModelFilters = document.getElementById(
          "processorModelFilters"
        );
        processorModelFilters.innerHTML = ""; // Temizle
        processors.forEach((processor) => {
          const div = document.createElement("div");
          div.className = "form-check";
          const input = document.createElement("input");
          input.className = "form-check-input";
          input.type = "checkbox";
          input.value = processor.value;
          input.id = processor.value;
          input.addEventListener("change", filterProducts);

          const label = document.createElement("label");
          label.className = "form-check-label";
          label.htmlFor = processor.value;
          label.textContent = processor.name;

          div.appendChild(input);
          div.appendChild(label);
          processorModelFilters.appendChild(div);
        });
      }

      function filterProcessorModels() {
        const searchTerm = document
          .getElementById("processorSearch")
          .value.toLowerCase();
        const filteredProcessors = processors.filter((processor) =>
          processor.name.toLowerCase().includes(searchTerm)
        );
        const processorModelFilters = document.getElementById(
          "processorModelFilters"
        );
        processorModelFilters.innerHTML = ""; // Temizle
        filteredProcessors.forEach((processor) => {
          const div = document.createElement("div");
          div.className = "form-check";
          const input = document.createElement("input");
          input.className = "form-check-input";
          input.type = "checkbox";
          input.value = processor.value;
          input.id = processor.value;
          input.addEventListener("change", filterProducts);

          const label = document.createElement("label");
          label.className = "form-check-label";
          label.htmlFor = processor.value;
          label.textContent = processor.name;

          div.appendChild(input);
          div.appendChild(label);
          processorModelFilters.appendChild(div);
        });
      }

      async function getProducts() {
        try {
          const response = await fetch(
            "https://hesaplipc.up.railway.app/api/getAll",
            {
              method: "GET",
              headers: {
                "Content-Type": "application/json",
              },
            }
          );
          const data = await response.json();
          return data;
        } catch (error) {
          console.error("Error:", error);
          return [];
        }
      }

      document
        .getElementById("filterInput")
        .addEventListener("keyup", function () {
          filterProducts();
        });

      document
        .getElementById("startPrice")
        .addEventListener("input", function () {
          filterProducts();
        });

      document
        .getElementById("endPrice")
        .addEventListener("input", function () {
          filterProducts();
        });

      document
        .getElementById("sortOrder")
        .addEventListener("change", function () {
          filterProducts();
        });

      document
        .querySelectorAll(".form-check-input")
        .forEach(function (checkbox) {
          checkbox.addEventListener("change", function () {
            filterProducts();
          });
        });

      document
        .getElementById("showInStock")
        .addEventListener("change", function () {
          filterProducts();
        });

      document.addEventListener("DOMContentLoaded", async function () {
        const products = await getProducts();
        filterProducts();
        document.getElementById("productCount").textContent = products.length;
      });

      async function filterProducts() {
        const filterValue = document
          .getElementById("filterInput")
          .value.toLowerCase();
        const startPrice =
          Number(document.getElementById("startPrice").value) || 0;
        const endPrice =
          Number(document.getElementById("endPrice").value) || Infinity;
        const selectedCPUs = Array.from(
          document.querySelectorAll(".form-check-input:checked")
        )
          .filter(
            (checkbox) =>
              checkbox.id.includes("Intel") || checkbox.id.includes("AMD")
          )
          .map((checkbox) => checkbox.value.toLowerCase());

        const selectedGPUs = Array.from(
          document.querySelectorAll(".form-check-input:checked")
        )
          .filter(
            (checkbox) =>
              checkbox.id.includes("RTX") ||
              checkbox.id.includes("GTX") ||
              checkbox.id.includes("RX")
          )
          .map((checkbox) => checkbox.value.toLowerCase());

        const selectedModels = Array.from(
          document.querySelectorAll(".form-check-input:checked")
        )
          .filter(
            (checkbox) =>
              !checkbox.id.includes("Intel") &&
              !checkbox.id.includes("AMD") &&
              !checkbox.id.includes("RTX") &&
              !checkbox.id.includes("GTX") &&
              !checkbox.id.includes("RX")
          )
          .map((checkbox) => checkbox.value.toLowerCase());

        const sortOrder = document.getElementById("sortOrder").value;

        const showInStock = document.getElementById("showInStock").checked;

        const products = await getProducts();
        let filteredProducts = products.filter(function (product) {
          const matchesFilter = product.name
            .toLowerCase()
            .includes(filterValue);
          const matchesPrice =
            product.price >= startPrice && product.price <= endPrice;

          let matchesCPU = true;
          if (selectedCPUs.length > 0) {
            matchesCPU = selectedCPUs.some((cpu) =>
              product.specs.CPU?.toLowerCase().includes(cpu)
            );
          }

          let matchesGPU = true;
          if (selectedGPUs.length > 0) {
            matchesGPU = selectedGPUs.some((gpu) =>
              product.specs.GPU?.toLowerCase().includes(gpu)
            );
          }

          let matchesModel = true;
          if (selectedModels.length > 0) {
            matchesModel = selectedModels.some((model) =>
              product.specs.CPU?.toLowerCase().includes(model)
            );
          }

          let matchesStock = true;
          if (showInStock) {
            matchesStock =
              product.price !== null &&
              product.price !== undefined &&
              product.price !== 0;
          }

          return (
            matchesFilter &&
            matchesPrice &&
            matchesCPU &&
            matchesGPU &&
            matchesModel &&
            matchesStock
          );
        });

        if (sortOrder === "lowToHigh") {
          filteredProducts.sort((a, b) => a.price - b.price);
        } else if (sortOrder === "highToLow") {
          filteredProducts.sort((a, b) => b.price - a.price);
        }

        renderProducts(filteredProducts);
        document.getElementById("productCount").textContent =
          filteredProducts.length;
      }

      function renderProducts(products) {
        const productList = document.getElementById("productList");
        productList.innerHTML = "";

        products.forEach(function (product) {
          const formattedPrice = new Intl.NumberFormat("tr-TR", {
            style: "currency",
            currency: "TRY",
          }).format(product.price ?? 0);

          const productCard = `
      <div class="col-md-4 product-item">
          <div class="card product-card">
              <img src="${
                product.image
              }" class="card-img-top product-image" alt="${
            product.name
          }" onerror="this.onerror=null;this.src='https://previews.123rf.com/images/blankstock/blankstock1812/blankstock181201188/113234166-no-or-stop-sign-computer-line-icon-pc-component-sign-monitor-with-case-symbol-caution-prohibited-ban.jpg';">
              <div class="card-body">
                  <h5 class="card-title">${product.name}</h5>
                  <ul class="list-unstyled">
                      <li><strong>CPU:</strong> ${product.specs.CPU ?? ""}</li>
                      <li><strong>GPU:</strong> ${product.specs.GPU ?? ""}</li>
                      <li><strong>Motherboard:</strong> ${
                        product.specs.Motherboard ?? ""
                      }</li>
                      <li><strong>RAM:</strong> ${product.specs.RAM ?? ""}</li>
                      <li><strong>Storage:</strong> ${
                        product.specs.Storage ?? ""
                      }</li>
                  </ul>
                  <p class="card-text"><strong>Fiyat: ${formattedPrice}</strong></p>
                  <a href="${
                    product.link
                  }" class="btn btn-primary">Detayları Gör</a>
              </div>
          </div>
      </div>
    `;
          productList.insertAdjacentHTML("beforeend", productCard);
        });
      }
    </script>
  </body>
</html>
