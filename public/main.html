<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>En Ucuz Hazır Sistem</title>
    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      .product-card {
        margin-bottom: 30px;
      }

      .product-image {
        height: 200px;
        object-fit: contain;
      }

      .card-body {
        font-size: 0.9rem;
      }

      .filter-sidebar {
        border-right: 1px solid #ddd;
        padding-right: 20px;
      }

      .filter-sidebar h5 {
        margin-top: 20px;
      }

      .scrollable-filters {
        max-height: 300px;
        overflow-y: auto;
      }
    </style>
  </head>

  <body>
    <div style="margin: 10px">
      <h1 class="text-center mb-5">Hazır Sistemler</h1>
      <div class="row">
        <div class="col-md-3 filter-sidebar" style="margin-left: 15px">
          <h5>Filtreler</h5>
          <button
            id="resetFilters"
            class="btn btn-secondary"
            style="width: 100%; background-color: #007bff"
          >
            Filtreleri Sıfırla
          </button>

          <div class="form-group row">
            <div class="col">
              <label for="startPrice">Başlangıç Fiyatı</label>
              <input
                type="number"
                id="startPrice"
                class="form-control"
                placeholder="0"
              />
            </div>
            <div class="col">
              <label for="endPrice">Bitiş Fiyatı</label>
              <input
                type="number"
                id="endPrice"
                class="form-control"
                placeholder="35000"
              />
            </div>
          </div>
          <div class="form-group" style="display: flex; flex-wrap: wrap; max-width: 300px;">
            <label style="width: 90%;">Mağaza</label><br />
            <div class="form-check" style="flex: 1 0 50%; box-sizing: border-box;">
              <input class="form-check-input" type="checkbox" value="itopya" id="itopya" />
              <label class="form-check-label" for="itopya">Itopya</label>
            </div>
            <div class="form-check" style="flex: 1 0 50%; box-sizing: border-box;">
              <input class="form-check-input" type="checkbox" value="gamingGen" id="gamingGen" />
              <label class="form-check-label" for="gamingGen">GamingGen</label>
            </div>
            <div class="form-check" style="flex: 1 0 50%; box-sizing: border-box;">
              <input class="form-check-input" type="checkbox" value="gameGaraj" id="gameGaraj" />
              <label class="form-check-label" for="gameGaraj">GameGaraj</label>
            </div>
            <div class="form-check" style="flex: 1 0 50%; box-sizing: border-box;">
              <input class="form-check-input" type="checkbox" value="pckolik" id="pckolik" />
              <label class="form-check-label" for="pckolik">PcKolik</label>
            </div>
            <div class="form-check" style="flex: 1 0 50%; box-sizing: border-box;">
              <input class="form-check-input" type="checkbox" value="vatan" id="vatan" />
              <label class="form-check-label" for="vatan">Vatan</label>
            </div>
          </div>
        </body>
          <div class="form-group row">
            <div class="form-group col">
              <label>İşlemci Markası</label><br />
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  value="Intel"
                  id="Intel"
                />
                <label class="form-check-label" for="Intel">Intel</label>
              </div>
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  value="AMD"
                  id="AMD"
                />
                <label class="form-check-label" for="AMD">AMD</label>
              </div>
            </div>
            <div class="form-group col">
              <label>Ekran Kartı</label><br />
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  value="RTX"
                  id="RTX"
                />
                <label class="form-check-label" for="RTX">NVIDIA RTX</label>
              </div>
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  value="GTX"
                  id="GTX"
                />
                <label class="form-check-label" for="GTX">NVIDIA GTX</label>
              </div>
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  value="RX"
                  id="RX"
                />
                <label class="form-check-label" for="RX">AMD RX</label>
              </div>
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  value="ARC"
                  id="ARC"
                />
                <label class="form-check-label" for="ARC">Intel ARC</label>
              </div>
            </div>
          </div>
          <div class="form-group">
            <label>Ekran Kartı Modeli</label><br />
            <input
              type="text"
              style="margin-bottom: 5px"
              id="gpuSearch"
              class="form-control"
              placeholder="Ekran kartı ara..."
            />
            <div id="gpuModelFilters" class="scrollable-filters">
              <!-- İşlemci modelleri dinamik olarak burada eklenecek -->
            </div>
          </div>
          <div class="form-group">
            <label>İşlemci Modeli</label><br />
            <input
              type="text"
              style="margin-bottom: 5px"
              id="processorSearch"
              class="form-control"
              placeholder="İşlemci modelinde ara..."
            />
            <div id="processorModelFilters" class="scrollable-filters">
              <!-- İşlemci modelleri dinamik olarak burada eklenecek -->
            </div>
          </div>
        </div>
        <div class="col-md-8">
          <div class="row mb-4">
            <div class="col-md-4">
              <input
                type="text"
                id="filterInput"
                class="form-control"
                placeholder="Ürün adında ara..."
              />
            </div>
            <div class="col-md-3">
              <select id="sortOrder" class="form-control">
                <option value="default">Sırala</option>
                <option value="lowToHigh">Fiyat: Düşükten Yükseğe</option>
                <option value="highToLow">Fiyat: Yüksekten Düşüğe</option>
              </select>
            </div>
            <div style="margin-top: 3px">
              <p style="display: inline; margin: 0 15px">Ürün Sayısı</p>
              <p id="productCount" style="display: inline; margin: 0 10px">0</p>
            </div>
            <div style="margin-top: 3px">
              <p style="display: inline; margin: 0 15px">Stoktakileri göster</p>
              <input
                type="checkbox"
                id="showInStock"
                style="margin: 0 10px"
                checked
              />
            </div>
          </div>

          <div class="row" id="productList">
            <!-- Ürün Kartları burada görüntülenecek -->
          </div>
        </div>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="data.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        populateProcessorModelFilters();
        populateGpuModelFilters();

        document
          .getElementById("processorSearch")
          .addEventListener("input", filterProcessorModels);
        document
          .getElementById("gpuSearch")
          .addEventListener("input", filterGpuModels);

        document
          .getElementById("resetFilters")
          .addEventListener("click", function () {
            document.getElementById("filterInput").value = "";
            document.getElementById("startPrice").value = "";
            document.getElementById("endPrice").value = "";
            document
              .querySelectorAll(".form-check-input")
              .forEach(function (checkbox) {
                checkbox.checked = false;
              });
            document.getElementById("sortOrder").value = "default";
            document.getElementById("showInStock").checked = true;
            filterProducts();
          });
      });

      function populateProcessorModelFilters() {
        const processorModelFilters = document.getElementById(
          "processorModelFilters"
        );
        processorModelFilters.innerHTML = ""; // Temizle
        processors.forEach((processor) => {
          const div = document.createElement("div");
          div.className = "form-check";
          const input = document.createElement("input");
          input.className = "form-check-input";
          input.type = "checkbox";
          input.value = processor.value;
          input.id = processor.value;
          input.addEventListener("change", filterProducts);

          const label = document.createElement("label");
          label.className = "form-check-label";
          label.htmlFor = processor.value;
          label.textContent = processor.name;

          div.appendChild(input);
          div.appendChild(label);
          processorModelFilters.appendChild(div);
        });
      }

      function populateGpuModelFilters() {
        const processorModelFilters =
          document.getElementById("gpuModelFilters");
        processorModelFilters.innerHTML = ""; // Temizle
        gpus.forEach((processor) => {
          const div = document.createElement("div");
          div.className = "form-check";
          const input = document.createElement("input");
          input.className = "form-check-input";
          input.type = "checkbox";
          input.value = processor.value;
          input.id = processor.value;
          input.addEventListener("change", filterProducts);

          const label = document.createElement("label");
          label.className = "form-check-label";
          label.htmlFor = processor.value;
          label.textContent = processor.name;

          div.appendChild(input);
          div.appendChild(label);
          processorModelFilters.appendChild(div);
        });
      }

      function filterProcessorModels() {
        const searchTerm = document
          .getElementById("processorSearch")
          .value.toLowerCase();
        const filteredProcessors = processors.filter((processor) =>
          processor.name.toLowerCase().includes(searchTerm)
        );
        const processorModelFilters = document.getElementById(
          "processorModelFilters"
        );
        processorModelFilters.innerHTML = ""; // Temizle
        filteredProcessors.forEach((processor) => {
          const div = document.createElement("div");
          div.className = "form-check";
          const input = document.createElement("input");
          input.className = "form-check-input";
          input.type = "checkbox";
          input.value = processor.value;
          input.id = processor.value;
          input.addEventListener("change", filterProducts);

          const label = document.createElement("label");
          label.className = "form-check-label";
          label.htmlFor = processor.value;
          label.textContent = processor.name;

          div.appendChild(input);
          div.appendChild(label);
          processorModelFilters.appendChild(div);
        });
      }

      function filterGpuModels() {
        const searchTerm = document
          .getElementById("gpuSearch")
          .value.toLowerCase();
        const filteredGpus = gpus.filter((gpu) =>
          gpu.name.toLowerCase().includes(searchTerm)
        );
        const gpuModelFilters = document.getElementById("gpuModelFilters");
        gpuModelFilters.innerHTML = ""; // Temizle
        filteredGpus.forEach((gpu) => {
          const div = document.createElement("div");
          div.className = "form-check";
          const input = document.createElement("input");
          input.className = "form-check-input";
          input.type = "checkbox";
          input.value = gpu.value;
          input.id = gpu.value;
          input.addEventListener("change", filterProducts);

          const label = document.createElement("label");
          label.className = "form-check-label";
          label.htmlFor = gpu.value;
          label.textContent = gpu.name;

          div.appendChild(input);
          div.appendChild(label);
          gpuModelFilters.appendChild(div);
        });
      }

      async function getProducts() {
        try {
          const response = await fetch(
            "https://hesaplipc.up.railway.app/api/getAll",
            {
              method: "GET",
              headers: {
                "Content-Type": "application/json",
              },
            }
          );
          const data = await response.json();
          return data;
        } catch (error) {
          console.error("Error:", error);
          return [];
        }
      }

      document
        .getElementById("filterInput")
        .addEventListener("keyup", function () {
          filterProducts();
        });

      document
        .getElementById("startPrice")
        .addEventListener("input", function () {
          filterProducts();
        });

      document
        .getElementById("endPrice")
        .addEventListener("input", function () {
          filterProducts();
        });

      document
        .getElementById("sortOrder")
        .addEventListener("change", function () {
          filterProducts();
        });

      document
        .querySelectorAll(".form-check-input")
        .forEach(function (checkbox) {
          checkbox.addEventListener("change", function () {
            filterProducts();
          });
        });

      document
        .getElementById("showInStock")
        .addEventListener("change", function () {
          filterProducts();
        });

      document.addEventListener("DOMContentLoaded", async function () {
        const products = await getProducts();
        filterProducts();
        document.getElementById("productCount").textContent = products.length;
      });

      async function filterProducts() {
        const filterValue = document
          .getElementById("filterInput")
          .value.toLowerCase();
        const startPrice =
          Number(document.getElementById("startPrice").value) || 0;
        const endPrice =
          Number(document.getElementById("endPrice").value) || Infinity;
        const selectedCPUs = Array.from(
          document.querySelectorAll(".form-check-input:checked")
        )
          .filter(
            (checkbox) =>
              checkbox.id.includes("Intel") || checkbox.id.includes("AMD")
          )
          .map((checkbox) => checkbox.value.toLowerCase());

        const selectedGPUs = Array.from(
          document.querySelectorAll(".form-check-input:checked")
        )
          .filter(
            (checkbox) =>
              checkbox.id.includes("RTX") ||
              checkbox.id.includes("GTX") ||
              checkbox.id.includes("ARC") ||
              checkbox.id.includes("RX")
          )
          .map((checkbox) => checkbox.value.toLowerCase());

        const selectedModels = Array.from(
          document.querySelectorAll(".form-check-input:checked")
        )
          .filter(
            (checkbox) =>
              !checkbox.id.includes("Intel") &&
              !checkbox.id.includes("AMD") &&
              !checkbox.id.includes("RTX") &&
              !checkbox.id.includes("ARC") &&
              !checkbox.id.includes("GTX") &&
              !checkbox.id.includes("RX") &&
              !checkbox.id.includes("itopya") &&
              !checkbox.id.includes("gamingGen") &&
              !checkbox.id.includes("pckolik") &&
              !checkbox.id.includes("vatan") &&
              !checkbox.id.includes("gameGaraj")
          )
          .map((checkbox) => checkbox.value.toLowerCase());

        const sortOrder = document.getElementById("sortOrder").value;
        const showInStock = document.getElementById("showInStock").checked;
        const selectedStores = Array.from(
          document.querySelectorAll(".form-check-input:checked")
        )
          .filter(
            (checkbox) =>
              checkbox.id.includes("itopya") ||
              checkbox.id.includes("gamingGen") ||
              checkbox.id.includes("gameGaraj") ||
              checkbox.id.includes("pckolik") ||
              checkbox.id.includes("vatan")
          )
          .map((checkbox) => checkbox.value.toLowerCase());

        const products = await getProducts();
        let filteredProducts = products.filter(function (product) {
          const matchesFilter = product.name
            .toLowerCase()
            .includes(filterValue);
          const matchesPrice =
            product.price >= startPrice && product.price <= endPrice;

          let matchesCPU = true;
          if (selectedCPUs.length > 0) {
            matchesCPU = selectedCPUs.some((cpu) =>
              product.specs.CPU?.toLowerCase().includes(cpu)
            );
          }

          let matchesGPU = true;
          if (selectedGPUs.length > 0) {
            matchesGPU = selectedGPUs.some((gpu) =>
              product.specs.GPU?.toLowerCase().includes(gpu)
            );
          }

          let matchesModel = true;
          if (selectedModels.length > 0) {
            matchesModel = selectedModels.some(
              (model) =>
                product.specs.CPU?.toLowerCase().includes(model) ||
                product.specs.GPU?.toLowerCase().trim().includes(model.trim())
            );
          }

          let matchesStock = true;
          if (showInStock) {
            matchesStock =
              product.price !== null &&
              product.price !== undefined &&
              product.price !== 0;
          }

          let matchesStore = true;
          if (selectedStores.length > 0) {
            matchesStore = selectedStores.some((store) =>
              product.store.toLowerCase().includes(store)
            );
          }

          return (
            matchesFilter &&
            matchesPrice &&
            matchesCPU &&
            matchesGPU &&
            matchesModel &&
            matchesStock &&
            matchesStore
          );
        });

        if (sortOrder === "lowToHigh") {
          filteredProducts.sort((a, b) => a.price - b.price);
        } else if (sortOrder === "highToLow") {
          filteredProducts.sort((a, b) => b.price - a.price);
        }

        renderProducts(filteredProducts);
        document.getElementById("productCount").textContent =
          filteredProducts.length;
      }

      function renderProducts(products) {
        const productList = document.getElementById("productList");
        productList.innerHTML = "";

        products.forEach(function (product) {
          const formattedPrice = new Intl.NumberFormat("tr-TR", {
            style: "currency",
            currency: "TRY",
          }).format(product.price ?? 0);

          const productCard = `
        <div class="col-md-4 product-item">
            <div class="card product-card">
                <img src="${
                  product.image
                }" class="card-img-top product-image" alt="${
            product.name
          }" onerror="this.onerror=null;this.src='https://previews.123rf.com/images/blankstock/blankstock1812/blankstock181201188/113234166-no-or-stop-sign-computer-line-icon-pc-component-sign-monitor-with-case-symbol-caution-prohibited-ban.jpg';">
                <div class="card-body">
                    <h5 class="card-title">${product.name}</h5>
                    <ul class="list-unstyled">
                        <li><strong>CPU:</strong> ${
                          product.specs.CPU ?? ""
                        }</li>
                        <li><strong>GPU:</strong> ${
                          product.specs.GPU ?? ""
                        }</li>
                        <li><strong>Motherboard:</strong> ${
                          product.specs.Motherboard ?? ""
                        }</li>
                        <li><strong>RAM:</strong> ${
                          product.specs.Ram ?? ""
                        }</li>
                        <li><strong>Storage:</strong> ${
                          product.specs?.Storage ?? ""
                        }</li>
                    </ul>
                    <p class="card-text"><strong>Fiyat: ${formattedPrice}</strong></p>
                    <a href="${
                      product.link
                    }" class="btn btn-primary">Detayları Gör</a>
                </div>
            </div>
        </div>
      `;
          productList.insertAdjacentHTML("beforeend", productCard);
        });
      }
    </script>
  </body>
</html>
